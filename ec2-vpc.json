{
   "AWSTemplateFormatVersion":"2010-09-09",
   "Description":"AWS CloudFormation Sample Template VPC_Single_Instance_In_Subnet: Sample template showing how to create a VPC and add an EC2 instance with an Elastic IP address and a security group. **WARNING** This template creates an Amazon EC2 instance. You will be billed for the AWS resources used if you create a stack from this template.",
   "Parameters":{
      "InstanceType":{
         "Description":"WebServer EC2 instance type",
         "Type":"String",
         "Default":"t2.micro",
         "AllowedValues":[
            "t1.micro",
            "t2.nano",
            "t2.micro",
            "t2.small",
            "t2.medium",
            "t2.large",
            "m1.small",
            "m1.medium",
            "m1.large",
            "m1.xlarge",
            "m2.xlarge",
            "m2.2xlarge",
            "m2.4xlarge",
            "m3.medium",
            "m3.large",
            "m3.xlarge",
            "m3.2xlarge",
            "m4.large",
            "m4.xlarge",
            "m4.2xlarge",
            "m4.4xlarge",
            "m4.10xlarge",
            "c1.medium",
            "c1.xlarge",
            "c3.large",
            "c3.xlarge",
            "c3.2xlarge",
            "c3.4xlarge",
            "c3.8xlarge",
            "c4.large",
            "c4.xlarge",
            "c4.2xlarge",
            "c4.4xlarge",
            "c4.8xlarge",
            "g2.2xlarge",
            "g2.8xlarge",
            "r3.large",
            "r3.xlarge",
            "r3.2xlarge",
            "r3.4xlarge",
            "r3.8xlarge",
            "i2.xlarge",
            "i2.2xlarge",
            "i2.4xlarge",
            "i2.8xlarge",
            "d2.xlarge",
            "d2.2xlarge",
            "d2.4xlarge",
            "d2.8xlarge",
            "hi1.4xlarge",
            "hs1.8xlarge",
            "cr1.8xlarge",
            "cc2.8xlarge",
            "cg1.4xlarge"
         ],
         "ConstraintDescription":"must be a valid EC2 instance type."
      },
      "KeyName":{
         "Description":"Name of an existing EC2 KeyPair to enable SSH access to the instance",
         "Type":"String",
         "MinLength":"1",
         "MaxLength":"255",
         "AllowedPattern":"[\\x20-\\x7E]*",
         "ConstraintDescription":"can contain only ASCII characters."
      },
      "SSHLocation":{
         "Description":" The IP address range that can be used to SSH to the EC2 instances",
         "Type":"String",
         "MinLength":"9",
         "MaxLength":"18",
         "Default":"0.0.0.0/0",
         "AllowedPattern":"(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
         "ConstraintDescription":"must be a valid IP CIDR range of the form x.x.x.x/x."
      }
   },
   "Mappings":{
      "RegionMap":{
         "us-east-1":{
            "AMI":"ami-7f418316"
         },
         "us-west-1":{
            "AMI":"ami-951945d0"
         },
         "us-west-2":{
            "AMI":"ami-16fd7026"
         },
         "eu-west-1":{
            "AMI":"ami-24506250"
         },
         "sa-east-1":{
            "AMI":"ami-3e3be423"
         },
         "ap-southeast-1":{
            "AMI":"ami-74dda626"
         },
         "ap-southeast-2":{
            "AMI":"ami-b3990e89"
         },
         "ap-northeast-1":{
            "AMI":"ami-dcfa4edd"
         }
      },
      "Region2Examples":{
         "us-east-1":{
            "Examples":"https://s3.amazonaws.com/cloudformation-examples-us-east-1"
         },
         "us-west-2":{
            "Examples":"https://s3-us-west-2.amazonaws.com/cloudformation-examples-us-west-2"
         },
         "us-west-1":{
            "Examples":"https://s3-us-west-1.amazonaws.com/cloudformation-examples-us-west-1"
         },
         "eu-west-1":{
            "Examples":"https://s3-eu-west-1.amazonaws.com/cloudformation-examples-eu-west-1"
         },
         "eu-west-2":{
            "Examples":"https://s3-eu-west-2.amazonaws.com/cloudformation-examples-eu-west-2"
         },
         "eu-west-3":{
            "Examples":"https://s3-eu-west-3.amazonaws.com/cloudformation-examples-eu-west-3"
         },
         "eu-central-1":{
            "Examples":"https://s3-eu-central-1.amazonaws.com/cloudformation-examples-eu-central-1"
         },
         "ap-southeast-1":{
            "Examples":"https://s3-ap-southeast-1.amazonaws.com/cloudformation-examples-ap-southeast-1"
         },
         "ap-northeast-1":{
            "Examples":"https://s3-ap-northeast-1.amazonaws.com/cloudformation-examples-ap-northeast-1"
         },
         "ap-northeast-2":{
            "Examples":"https://s3-ap-northeast-2.amazonaws.com/cloudformation-examples-ap-northeast-2"
         },
         "ap-northeast-3":{
            "Examples":"https://s3-ap-northeast-3.amazonaws.com/cloudformation-examples-ap-northeast-3"
         },
         "ap-southeast-2":{
            "Examples":"https://s3-ap-southeast-2.amazonaws.com/cloudformation-examples-ap-southeast-2"
         },
         "ap-south-1":{
            "Examples":"https://s3-ap-south-1.amazonaws.com/cloudformation-examples-ap-south-1"
         },
         "us-east-2":{
            "Examples":"https://s3-us-east-2.amazonaws.com/cloudformation-examples-us-east-2"
         },
         "ca-central-1":{
            "Examples":"https://s3-ca-central-1.amazonaws.com/cloudformation-examples-ca-central-1"
         },
         "sa-east-1":{
            "Examples":"https://s3-sa-east-1.amazonaws.com/cloudformation-examples-sa-east-1"
         },
         "cn-north-1":{
            "Examples":"https://s3.cn-north-1.amazonaws.com.cn/cloudformation-examples-cn-north-1"
         },
         "cn-northwest-1":{
            "Examples":"https://s3.cn-northwest-1.amazonaws.com.cn/cloudformation-examples-cn-northwest-1"
         }
      },
      "AWSInstanceType2Arch":{
         "t1.micro":{
            "Arch":"HVM64"
         },
         "t2.nano":{
            "Arch":"HVM64"
         },
         "t2.micro":{
            "Arch":"HVM64"
         },
         "t2.small":{
            "Arch":"HVM64"
         },
         "t2.medium":{
            "Arch":"HVM64"
         },
         "t2.large":{
            "Arch":"HVM64"
         },
         "m1.small":{
            "Arch":"HVM64"
         },
         "m1.medium":{
            "Arch":"HVM64"
         },
         "m1.large":{
            "Arch":"HVM64"
         },
         "m1.xlarge":{
            "Arch":"HVM64"
         },
         "m2.xlarge":{
            "Arch":"HVM64"
         },
         "m2.2xlarge":{
            "Arch":"HVM64"
         },
         "m2.4xlarge":{
            "Arch":"HVM64"
         },
         "m3.medium":{
            "Arch":"HVM64"
         },
         "m3.large":{
            "Arch":"HVM64"
         },
         "m3.xlarge":{
            "Arch":"HVM64"
         },
         "m3.2xlarge":{
            "Arch":"HVM64"
         },
         "m4.large":{
            "Arch":"HVM64"
         },
         "m4.xlarge":{
            "Arch":"HVM64"
         },
         "m4.2xlarge":{
            "Arch":"HVM64"
         },
         "m4.4xlarge":{
            "Arch":"HVM64"
         },
         "m4.10xlarge":{
            "Arch":"HVM64"
         },
         "c1.medium":{
            "Arch":"HVM64"
         },
         "c1.xlarge":{
            "Arch":"HVM64"
         },
         "c3.large":{
            "Arch":"HVM64"
         },
         "c3.xlarge":{
            "Arch":"HVM64"
         },
         "c3.2xlarge":{
            "Arch":"HVM64"
         },
         "c3.4xlarge":{
            "Arch":"HVM64"
         },
         "c3.8xlarge":{
            "Arch":"HVM64"
         },
         "c4.large":{
            "Arch":"HVM64"
         },
         "c4.xlarge":{
            "Arch":"HVM64"
         },
         "c4.2xlarge":{
            "Arch":"HVM64"
         },
         "c4.4xlarge":{
            "Arch":"HVM64"
         },
         "c4.8xlarge":{
            "Arch":"HVM64"
         },
         "g2.2xlarge":{
            "Arch":"HVMG2"
         },
         "g2.8xlarge":{
            "Arch":"HVMG2"
         },
         "r3.large":{
            "Arch":"HVM64"
         },
         "r3.xlarge":{
            "Arch":"HVM64"
         },
         "r3.2xlarge":{
            "Arch":"HVM64"
         },
         "r3.4xlarge":{
            "Arch":"HVM64"
         },
         "r3.8xlarge":{
            "Arch":"HVM64"
         },
         "i2.xlarge":{
            "Arch":"HVM64"
         },
         "i2.2xlarge":{
            "Arch":"HVM64"
         },
         "i2.4xlarge":{
            "Arch":"HVM64"
         },
         "i2.8xlarge":{
            "Arch":"HVM64"
         },
         "d2.xlarge":{
            "Arch":"HVM64"
         },
         "d2.2xlarge":{
            "Arch":"HVM64"
         },
         "d2.4xlarge":{
            "Arch":"HVM64"
         },
         "d2.8xlarge":{
            "Arch":"HVM64"
         },
         "hi1.4xlarge":{
            "Arch":"HVM64"
         },
         "hs1.8xlarge":{
            "Arch":"HVM64"
         },
         "cr1.8xlarge":{
            "Arch":"HVM64"
         },
         "cc2.8xlarge":{
            "Arch":"HVM64"
         }
      },
      "AWSInstanceType2NATArch":{
         "t1.micro":{
            "Arch":"NATHVM64"
         },
         "t2.nano":{
            "Arch":"NATHVM64"
         },
         "t2.micro":{
            "Arch":"NATHVM64"
         },
         "t2.small":{
            "Arch":"NATHVM64"
         },
         "t2.medium":{
            "Arch":"NATHVM64"
         },
         "t2.large":{
            "Arch":"NATHVM64"
         },
         "m1.small":{
            "Arch":"NATHVM64"
         },
         "m1.medium":{
            "Arch":"NATHVM64"
         },
         "m1.large":{
            "Arch":"NATHVM64"
         },
         "m1.xlarge":{
            "Arch":"NATHVM64"
         },
         "m2.xlarge":{
            "Arch":"NATHVM64"
         },
         "m2.2xlarge":{
            "Arch":"NATHVM64"
         },
         "m2.4xlarge":{
            "Arch":"NATHVM64"
         },
         "m3.medium":{
            "Arch":"NATHVM64"
         },
         "m3.large":{
            "Arch":"NATHVM64"
         },
         "m3.xlarge":{
            "Arch":"NATHVM64"
         },
         "m3.2xlarge":{
            "Arch":"NATHVM64"
         },
         "m4.large":{
            "Arch":"NATHVM64"
         },
         "m4.xlarge":{
            "Arch":"NATHVM64"
         },
         "m4.2xlarge":{
            "Arch":"NATHVM64"
         },
         "m4.4xlarge":{
            "Arch":"NATHVM64"
         },
         "m4.10xlarge":{
            "Arch":"NATHVM64"
         },
         "c1.medium":{
            "Arch":"NATHVM64"
         },
         "c1.xlarge":{
            "Arch":"NATHVM64"
         },
         "c3.large":{
            "Arch":"NATHVM64"
         },
         "c3.xlarge":{
            "Arch":"NATHVM64"
         },
         "c3.2xlarge":{
            "Arch":"NATHVM64"
         },
         "c3.4xlarge":{
            "Arch":"NATHVM64"
         },
         "c3.8xlarge":{
            "Arch":"NATHVM64"
         },
         "c4.large":{
            "Arch":"NATHVM64"
         },
         "c4.xlarge":{
            "Arch":"NATHVM64"
         },
         "c4.2xlarge":{
            "Arch":"NATHVM64"
         },
         "c4.4xlarge":{
            "Arch":"NATHVM64"
         },
         "c4.8xlarge":{
            "Arch":"NATHVM64"
         },
         "g2.2xlarge":{
            "Arch":"NATHVMG2"
         },
         "g2.8xlarge":{
            "Arch":"NATHVMG2"
         },
         "r3.large":{
            "Arch":"NATHVM64"
         },
         "r3.xlarge":{
            "Arch":"NATHVM64"
         },
         "r3.2xlarge":{
            "Arch":"NATHVM64"
         },
         "r3.4xlarge":{
            "Arch":"NATHVM64"
         },
         "r3.8xlarge":{
            "Arch":"NATHVM64"
         },
         "i2.xlarge":{
            "Arch":"NATHVM64"
         },
         "i2.2xlarge":{
            "Arch":"NATHVM64"
         },
         "i2.4xlarge":{
            "Arch":"NATHVM64"
         },
         "i2.8xlarge":{
            "Arch":"NATHVM64"
         },
         "d2.xlarge":{
            "Arch":"NATHVM64"
         },
         "d2.2xlarge":{
            "Arch":"NATHVM64"
         },
         "d2.4xlarge":{
            "Arch":"NATHVM64"
         },
         "d2.8xlarge":{
            "Arch":"NATHVM64"
         },
         "hi1.4xlarge":{
            "Arch":"NATHVM64"
         },
         "hs1.8xlarge":{
            "Arch":"NATHVM64"
         },
         "cr1.8xlarge":{
            "Arch":"NATHVM64"
         },
         "cc2.8xlarge":{
            "Arch":"NATHVM64"
         }
      },
      "AWSRegionArch2AMI":{
         "us-east-1":{
            "HVM64":"ami-0ff8a91507f77f867",
            "HVMG2":"ami-0a584ac55a7631c0c"
         },
         "us-west-2":{
            "HVM64":"ami-a0cfeed8",
            "HVMG2":"ami-0e09505bc235aa82d"
         },
         "us-west-1":{
            "HVM64":"ami-0bdb828fd58c52235",
            "HVMG2":"ami-066ee5fd4a9ef77f1"
         },
         "eu-west-1":{
            "HVM64":"ami-047bb4163c506cd98",
            "HVMG2":"ami-0a7c483d527806435"
         },
         "eu-west-2":{
            "HVM64":"ami-f976839e",
            "HVMG2":"NOT_SUPPORTED"
         },
         "eu-west-3":{
            "HVM64":"ami-0ebc281c20e89ba4b",
            "HVMG2":"NOT_SUPPORTED"
         },
         "eu-central-1":{
            "HVM64":"ami-0233214e13e500f77",
            "HVMG2":"ami-06223d46a6d0661c7"
         },
         "ap-northeast-1":{
            "HVM64":"ami-06cd52961ce9f0d85",
            "HVMG2":"ami-053cdd503598e4a9d"
         },
         "ap-northeast-2":{
            "HVM64":"ami-0a10b2721688ce9d2",
            "HVMG2":"NOT_SUPPORTED"
         },
         "ap-northeast-3":{
            "HVM64":"ami-0d98120a9fb693f07",
            "HVMG2":"NOT_SUPPORTED"
         },
         "ap-southeast-1":{
            "HVM64":"ami-08569b978cc4dfa10",
            "HVMG2":"ami-0be9df32ae9f92309"
         },
         "ap-southeast-2":{
            "HVM64":"ami-09b42976632b27e9b",
            "HVMG2":"ami-0a9ce9fecc3d1daf8"
         },
         "ap-south-1":{
            "HVM64":"ami-0912f71e06545ad88",
            "HVMG2":"ami-097b15e89dbdcfcf4"
         },
         "us-east-2":{
            "HVM64":"ami-0b59bfac6be064b78",
            "HVMG2":"NOT_SUPPORTED"
         },
         "ca-central-1":{
            "HVM64":"ami-0b18956f",
            "HVMG2":"NOT_SUPPORTED"
         },
         "sa-east-1":{
            "HVM64":"ami-07b14488da8ea02a0",
            "HVMG2":"NOT_SUPPORTED"
         },
         "cn-north-1":{
            "HVM64":"ami-0a4eaf6c4454eda75",
            "HVMG2":"NOT_SUPPORTED"
         },
         "cn-northwest-1":{
            "HVM64":"ami-6b6a7d09",
            "HVMG2":"NOT_SUPPORTED"
         }
      }
   },
   "Resources":{
      "VPC":{
         "Type":"AWS::EC2::VPC",
         "Properties":{
            "CidrBlock":"10.0.0.0/16",
            "Tags":[
               {
                  "Key":"Application",
                  "Value":{
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "Subnet":{
         "Type":"AWS::EC2::Subnet",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "CidrBlock":"10.0.0.0/24",
            "Tags":[
               {
                  "Key":"Application",
                  "Value":{
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "InternetGateway":{
         "Type":"AWS::EC2::InternetGateway",
         "Properties":{
            "Tags":[
               {
                  "Key":"Application",
                  "Value":{
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "AttachGateway":{
         "Type":"AWS::EC2::VPCGatewayAttachment",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "InternetGatewayId":{
               "Ref":"InternetGateway"
            }
         }
      },
      "RouteTable":{
         "Type":"AWS::EC2::RouteTable",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "Tags":[
               {
                  "Key":"Application",
                  "Value":{
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "Route":{
         "Type":"AWS::EC2::Route",
         "DependsOn":"AttachGateway",
         "Properties":{
            "RouteTableId":{
               "Ref":"RouteTable"
            },
            "DestinationCidrBlock":"0.0.0.0/0",
            "GatewayId":{
               "Ref":"InternetGateway"
            }
         }
      },
      "SubnetRouteTableAssociation":{
         "Type":"AWS::EC2::SubnetRouteTableAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"Subnet"
            },
            "RouteTableId":{
               "Ref":"RouteTable"
            }
         }
      },
      "NetworkAcl":{
         "Type":"AWS::EC2::NetworkAcl",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "Tags":[
               {
                  "Key":"Application",
                  "Value":{
                     "Ref":"AWS::StackId"
                  }
               }
            ]
         }
      },
      "SubnetNetworkAclAssociation":{
         "Type":"AWS::EC2::SubnetNetworkAclAssociation",
         "Properties":{
            "SubnetId":{
               "Ref":"Subnet"
            },
            "NetworkAclId":{
               "Ref":"NetworkAcl"
            }
         }
      },
      "IPAddress":{
         "Type":"AWS::EC2::EIP",
         "DependsOn":"AttachGateway",
         "Properties":{
            "Domain":"vpc",
            "InstanceId":{
               "Ref":"WebServerInstance"
            }
         }
      },
      "InstanceSecurityGroup":{
         "Type":"AWS::EC2::SecurityGroup",
         "Properties":{
            "VpcId":{
               "Ref":"VPC"
            },
            "GroupDescription":"Enable SSH access via port 22",
            "SecurityGroupIngress":[
               {
                  "IpProtocol":"tcp",
                  "FromPort":"22",
                  "ToPort":"22",
                  "CidrIp":{
                     "Ref":"SSHLocation"
                  }
               },
               {
                  "IpProtocol":"tcp",
                  "FromPort":"80",
                  "ToPort":"80",
                  "CidrIp":"0.0.0.0/0"
               }
            ]
         }
      },
      "WebServerInstance":{
         "Type":"AWS::EC2::Instance",
         "Properties":{
            "SecurityGroups": [
               {
                   "Ref": "InstanceSecurityGroup"
               }
           ],
            "KeyName":{
               "Ref":"KeyName"
            },
            "ImageId":{
               "Fn::FindInMap":[
                  "RegionMap",
                  {
                     "Ref":"AWS::Region"
                  },
                  "AMI"
               ]
            },
            "UserData":{
               "Fn::Base64":"80"
            }
         }
      }
   },
   "Outputs":{
      "URL":{
         "Value":{
            "Fn::Join":[
               "",
               [
                  "http://",
                  {
                     "Fn::GetAtt":[
                        "WebServerInstance",
                        "PublicIp"
                     ]
                  }
               ]
            ]
         },
         "Description":"Newly created application URL"
      }
   }
}